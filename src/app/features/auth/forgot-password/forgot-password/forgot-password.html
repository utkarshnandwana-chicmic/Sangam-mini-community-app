<div class="auth-wrapper">
  <div class="auth-card animate-fade-in">
    
    <div class="progress-bar-container" *ngIf="currentStep < 4">
      <div class="progress-fill" [style.width.%]="(currentStep / 3) * 100"></div>
    </div>

    <div class="brand-header">
      <div class="logo-box">
        <span class="logo-icon">{{ currentStep === Step.RESET ? 'üîê' : 'üõ°Ô∏è' }}</span>
      </div>
      <h1 class="title-text">{{ getStepTitle() }}</h1>
      <p class="subtitle-text">{{ getStepSubtitle() }}</p>
    </div>

    <div class="error-toast animate-shake" *ngIf="errorMessage">
      <span class="icon">‚ö†Ô∏è</span> {{ errorMessage }}
    </div>

    <div class="form-content">
      
      <form *ngIf="currentStep === Step.PHONE" [formGroup]="phoneForm" (ngSubmit)="sendOtp()">
        <div class="input-group">
          <label class="input-label">Phone Number</label>
          <div class="input-wrapper" [class.input-error]="submitted && phoneForm.get('phone')?.invalid">
            <span class="prefix">+91</span>
            <input 
              type="tel" 
              formControlName="phone" 
              appNoLeadingSpace
              inputmode="numeric"
              (input)="onPhoneInput($event)"
              placeholder="Enter 10 digits" 
              class="clean-input" 
              maxlength="10">
          </div>
          <div class="field-error" *ngIf="submitted && phoneForm.get('phone')?.invalid">
            Please enter a valid 10-digit phone number.
          </div>
        </div>
        <button class="action-btn" type="submit" [disabled]="loading || phoneForm.invalid">
          {{ loading ? 'Sending...' : 'Send Reset Code' }}
        </button>
      </form>

      <form *ngIf="currentStep === Step.OTP" [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
        <div class="input-group">
          <label class="input-label">Verification Code</label>
          <div class="input-wrapper" [class.input-error]="submitted && otpForm.get('otp')?.invalid">
            <input 
              type="text" 
              formControlName="otp" 
              appNoLeadingSpace
              inputmode="numeric"
              (input)="onOtpInput($event)"
              placeholder="000 000" 
              class="clean-input otp-input" 
              maxlength="6">
          </div>
          <div class="field-error" *ngIf="submitted && otpForm.get('otp')?.invalid">
            Invalid verification code.
          </div>
        </div>
        <button class="action-btn" type="submit" [disabled]="loading || otpForm.invalid">
          {{ loading ? 'Verifying...' : 'Verify Code' }}
        </button>
      </form>

      <form *ngIf="currentStep === Step.RESET" [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
        <div class="input-group">
          <label class="input-label">New Password</label>
          <div class="input-wrapper password-box" [class.input-error]="submitted && passwordForm.get('newPassword')?.invalid">
            <input 
              [type]="hidePassword ? 'password' : 'text'" 
              formControlName="newPassword" 
              appNoLeadingSpace
              (input)="onInputChange()"
              placeholder="Minimum 8 characters" 
              class="clean-input">
            <button type="button" class="eye-toggle" (click)="hidePassword = !hidePassword">
              <svg *ngIf="hidePassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
              <svg *ngIf="!hidePassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
            </button>
          </div>
          <div class="field-error" *ngIf="submitted && passwordForm.get('newPassword')?.invalid">
            Must contain a capital letter and a number.
          </div>
        </div>
        <button class="action-btn" type="submit" [disabled]="loading || passwordForm.invalid">
          {{ loading ? 'Saving...' : 'Update Password' }}
        </button>
      </form>
    </div>

    <div class="auth-footer">
      <a routerLink="/login" class="back-link">Return to Login</a>
    </div>
  </div>
</div>
